package com.lvfulo.controller.upload;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.io.InputStream;
import java.io.OutputStream;
import java.util.Date;

import com.lvfulo.utils.ToolUtils;

import sun.misc.BASE64Decoder;
import sun.misc.BASE64Encoder;

public class bsae64 {
	public static void main(String[] args) {
		// 测试从Base64编码转换为图片文件
		String strImg = "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";
		GenerateImage(strImg, "E:\\wangyc.jpg");

		// 测试从图片文件转换为Base64编码
		System.out.println(GetImageStr("E:\\wangyc.jpg"));
	}

	// 创建路径
	public static File uploadFile(String filepath, String filename) throws IOException {
		String daString = ToolUtils.GetFmtDate(new Date(), "yyyyMMdd")+"/";
		filepath += daString;
		File tempFile = new File(filepath, new Date().getTime() + String.valueOf(filename));
		if (!tempFile.exists()) {
			tempFile.mkdirs();
		}
		return tempFile;
	}

	public static String GetImageStr(String imgFilePath) {// 将图片文件转化为字节数组字符串，并对其进行Base64编码处理
		byte[] data = null;

		// 读取图片字节数组
		try {
			InputStream in = new FileInputStream(imgFilePath);
			data = new byte[in.available()];
			in.read(data);
			in.close();
		} catch (IOException e) {
			e.printStackTrace();
		}

		// 对字节数组Base64编码
		BASE64Encoder encoder = new BASE64Encoder();
		return encoder.encode(data);// 返回Base64编码过的字节数组字符串
	}

	public static boolean GenerateImage(String imgStr, String imgFilePath) {// 对字节数组字符串进行Base64解码并生成图片
		if (imgStr == null) // 图像数据为空
			return false;
		BASE64Decoder decoder = new BASE64Decoder();
		try {
			// Base64解码
			byte[] bytes = decoder.decodeBuffer(imgStr);
			for (int i = 0; i < bytes.length; ++i) {
				if (bytes[i] < 0) {// 调整异常数据
					bytes[i] += 256;
				}
			}
			// 生成jpeg图片
			OutputStream out = new FileOutputStream(imgFilePath);
			out.write(bytes);
			out.flush();
			out.close();
			return true;
		} catch (Exception e) {
			return false;
		}
	}
}